<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Esfera de Dyson com 3 Anéis</title>
  
  <link rel="stylesheet" href="style.css">

  <!-- Importmap para Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.168.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

<div id="info">Esfera de Dyson • Arraste: rotacionar • Role: zoom</div>

<script type="module">
  import * as THREE from 'three';
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

  // Carrega as configurações do JSON
  async function loadConfig() {
    try {
      const response = await fetch('config.json');
      if (!response.ok) throw new Error('Falha ao carregar config.json');
      return await response.json();
    } catch (err) {
      console.error('Erro ao carregar config:', err);
      // Configuração fallback caso o JSON falhe
      return {
        "star": { "radius": 18, "color": 0xffeeaa, "emissive": 0xffaa44, "emissiveIntensity": 1.8 },
        "rings": [
          { "radius": 45, "thickness": 1.8, "color": 0x88ffdd, "speed": 0.008, "tiltX": 0.12, "tiltY": 0.05 },
          { "radius": 75, "thickness": 2.2, "color": 0x44aaff, "speed": 0.005, "tiltX": -0.08, "tiltY": 0.15 },
          { "radius": 110, "thickness": 3.0, "color": 0xff88cc, "speed": 0.003, "tiltX": 0.04, "tiltY": -0.1 }
        ],
        "camera": { "fov": 55, "position": [0, 40, 120] },
        "background": 0x000814
      };
    }
  }

  // Inicia após carregar o JSON
  loadConfig().then(config => {
    // Cena
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(config.background);

    const camera = new THREE.PerspectiveCamera(
      config.camera.fov,
      window.innerWidth / window.innerHeight,
      0.1,
      2000
    );
    camera.position.set(...config.camera.position);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.1;
    document.body.appendChild(renderer.domElement);

    // Controles
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.04;
    controls.minDistance = 30;
    controls.maxDistance = 400;

    // Luzes
    const starLight = new THREE.PointLight(0xffffff, 3.5, 0, 2);
    starLight.position.set(0, 0, 0);
    scene.add(starLight);
    scene.add(new THREE.AmbientLight(0x112244, 0.4));

    // Material de glow simples
    const glowMaterial = new THREE.MeshBasicMaterial({
      color: 0xffffff,
      transparent: true,
      opacity: 0.08
    });

    // Estrela central
    const starGeo = new THREE.SphereGeometry(config.star.radius, 48, 32);
    const starMat = new THREE.MeshStandardMaterial({
      color: config.star.color,
      emissive: config.star.emissive,
      emissiveIntensity: config.star.emissiveIntensity,
      metalness: 0.1,
      roughness: 0.4
    });
    const star = new THREE.Mesh(starGeo, starMat);
    scene.add(star);

    const glowStar = new THREE.Mesh(starGeo, glowMaterial);
    glowStar.scale.set(1.15, 1.15, 1.15);
    scene.add(glowStar);

    // Criação dos anéis
    const rings = [];
    config.rings.forEach(ringConfig => {
      const ringGroup = new THREE.Group();

      const ringGeo = new THREE.TorusGeometry(
        ringConfig.radius,
        ringConfig.thickness,
        16,
        160
      );

      const ringMat = new THREE.MeshPhysicalMaterial({
        color: ringConfig.color,
        metalness: 0.95,
        roughness: 0.12,
        clearcoat: 0.9,
        clearcoatRoughness: 0.05,
        emissive: ringConfig.color,
        emissiveIntensity: 0.4
      });

      const ring = new THREE.Mesh(ringGeo, ringMat);
      ring.rotation.x = Math.PI * ringConfig.tiltX;
      ring.rotation.y = Math.PI * ringConfig.tiltY;
      ringGroup.add(ring);

      const ringGlow = new THREE.Mesh(ringGeo, glowMaterial);
      ringGlow.scale.set(1.08, 1.08, 1.08);
      ringGroup.add(ringGlow);

      ringGroup.userData = { speed: ringConfig.speed };
      scene.add(ringGroup);
      rings.push(ringGroup);
    });

    // Animação
    function animate() {
      requestAnimationFrame(animate);

      star.rotation.y += 0.0008;

      rings.forEach(ring => {
        ring.rotation.z += ring.userData.speed;
      });

      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  });
</script>

</body>
</html>